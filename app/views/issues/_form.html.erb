<%= form_with(model: issue, class: "contents") do |form| %>
  <% if issue.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-md mt-3">
      <h2><%= pluralize(issue.errors.count, "error") %> prohibited this issue from being saved:</h2>

      <ul class="list-disc ml-6">
        <% issue.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="my-5">
    <% if issue.photo.attached? %>
      <div class="mb-2">
        Current photo:<br>
        <%= image_tag issue.photo.variant(resize_to_limit: [300, 300]), class: "rounded-md" %>
      </div>
    <% end %>
    <%= form.label :photo, "Photo" %>
    <%= form.file_field :photo, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": issue.errors[:photo].none?, "border-red-400 focus:outline-red-600": issue.errors[:photo].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :comment %>
    <%= form.textarea :comment, rows: 4, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": issue.errors[:comment].none?, "border-red-400 focus:outline-red-600": issue.errors[:comment].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :location, "Issue Location", class: "block font-medium mb-2" %>
    <p class="text-sm text-gray-600 mb-2">Click on the map or drag the pin to set the issue location</p>

    <div data-controller="map"
         data-map-latitude-value="<%= issue.latitude %>"
         data-map-longitude-value="<%= issue.longitude %>"
         data-map-address-value="<%= issue.street_address %>"
         data-map-editable-value="true"
         class="relative">
      <div data-map-target="container" class="w-full rounded-md border border-gray-300"></div>

      <%= form.hidden_field :latitude, data: { map_target: "latitude" } %>
      <%= form.hidden_field :longitude, data: { map_target: "longitude" } %>
      <%= form.hidden_field :street_address, data: { map_target: "address" } %>
    </div>

    <% if issue.errors[:latitude].any? || issue.errors[:longitude].any? || issue.errors[:street_address].any? %>
      <p class="text-red-500 text-sm mt-2">Please select a location on the map</p>
    <% end %>
  </div>

  <div class="inline">
    <%= form.submit class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
  </div>
<% end %>
